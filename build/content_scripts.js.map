{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./src/helpers.js","webpack:///./src/cards.js","webpack:///./src/index.js","webpack:///./src/endings.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","loadOn","$","show","loadOff","hide","getCookie","matches","document","cookie","match","RegExp","replace","decodeURIComponent","undefined","localStorageSetItem","oldArray","localStorageGetItem","newArray","arr","len","length","out","obj","push","unique","concat","localStorage","setItem","JSON","stringify","parse","getItem","listItemTmp","item","error","exec","URL","channelId","videos","topPlVideos","newVideos","mostViewedVideos","ytVideos","cardsTemplates","doneVideoCount","client","version","apiKey","ar","templates","IDS","MESSAGES","TEASERS","COPY_IDS","PL_IDS","checkUser","append","chrome","runtime","sendMessage","action","response","elArr","getYtScripts","doc","DOMParser","parseFromString","sText","filter","el","textContent","indexOf","split","responseContext","serviceTrackingParams","forEach","service","params","checkAuthState","Error","e","console","log","find","attr","getChannelId","getTemplates","scripts","tagText","alert","auth_token","now","Date","expireTime","getTime","setTime","toGMTString","setCookie","getYtAr","id","title","getElementsByTagName","text","html","getChannelTitle","getVideos","page","addClass","promiseArr","parser","elements","time","splice","video","playlistVideoRenderer","videoId","lengthSeconds","checkVideoCard","Promise","all","then","removeClass","videoPromise","resolve","reject","v","feature_templates","fillErrors","options","Array","slice","copyCards","each","idx","video_id","playlist_id","channel_url","custom_message","teaser_text","val","toLowerCase","extension","onMessage","addListener","msg","sender","sendResponse","on","preventDefault","links","css","clearArray","filledArray","filledArrayToClear","messages","teasers","start_ms","videoData","type","show_warnings","video_item_id","video_url","session_token","lengthStep","Math","round","action_create_video","action_create_collaborator","getParams","cards","k","array","clearSubArray","filledSubArray","ceil","setCardPromise","reduce","previousPromise","subItem","allVideos","element","errors","form_errors","message","er","trim","setCard","clearCard","currentTarget","dataset","btn","toggleClass","hasClass","closest","plId","ytData","contents","twoColumnBrowseResultsRenderer","tabs","tabRenderer","content","sectionListRenderer","itemSectionRenderer","playlistVideoListRenderer","results","getTopPlVideos","itemImg","ytId","cookie_name","ch_id_name","tollName","matchCall","matchEndings","itemsObj","startState","token","videoTmpId","itemsArr","prop","removeItem","data","description","status","showPopup","documentElement","overlay","innerHTML","image_url","channel_id","j","resp","slideUp","this","remove","is_promo","metadata_errors","setTimeout","group","tmpId","for_editor","videoObj","body","listWrap","getElementsByClassName","tokenInp","setAttribute","checkChannelId","trigger","list","newLi","createElement","onclick","appendChild","endings"],"mappings":"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","file":"content_scripts.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 6);\n","export function loadOn() {\n  $(\".b-loader\").show();\n}\n\nexport function showPopup(text) {\n  $(\".b-popup\").addClass(\"_show\");\n  $(\".b-popup-box\").html(text);\n  setTimeout(() => {\n    hidePopup();\n  }, 1500);\n}\n\nexport function hidePopup() {\n  $(\".b-popup\").removeClass(\"_show\");\n}\n\nexport function loadOff() {\n  $(\".b-loader\").hide();\n}\n\nexport function getCookie(name) {\n  var matches = document.cookie.match(\n    new RegExp(\n      \"(?:^|; )\" +\n        name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, \"\\\\$1\") +\n        \"=([^;]*)\"\n    )\n  );\n  return matches ? decodeURIComponent(matches[1]) : undefined;\n}\n\nexport function localStorageSetItem(key, value) {\n  if (!value) return;\n  \n  let oldArray = localStorageGetItem(key);\n  \n  if (!oldArray) {\n    oldArray = [];\n  }\n\n  const newArray = unique(oldArray.concat(value));\n\n  localStorage.setItem(key, JSON.stringify(newArray));\n}\n\nexport function localStorageGetItem(key) {\n  return JSON.parse(localStorage.getItem(key));\n}\n\nfunction unique(arr) {\n  var i,\n      len = arr.length,\n      out = [],\n      obj = { };\n  \n  for (i = 0; i < len; i++) {\n      obj[arr[i]] = 0;\n  }\n  for (i in obj) {\n      out.push(i);\n  }\n  return out;\n};","import { loadOn } from \"./helpers\";\nimport { loadOff } from \"./helpers\";\nimport { getCookie } from \"./helpers\";\nimport { localStorageSetItem } from \"./helpers\";\nimport { localStorageGetItem } from \"./helpers\";\n\nfunction listItemTmp (item, error) {\n  let listClass = error ? 'error-list-item' : 'js-list-item';\n\n  return `<div class=\"${listClass}\">${item}</div>`;\n}\n\nexport default function() {\n  const cookie_name = \"tools_auth_token_\";\n  const ch_id_name = \"tools_channel_id\";\n  let channelId = \"\";\n  let videos = [];\n  let topPlVideos = [];\n  let newVideos = [];\n  let mostViewedVideos = [];\n  let ytVideos = [];\n  let cardsTemplates = [];\n  let doneVideoCount = 0;\n\n  const client = {\n    version: '',\n    apiKey: '',\n    ar: ''\n  }\n\n  const templates = {\n    IDS: [],\n    MESSAGES: [],\n    TEASERS: [],\n    COPY_IDS: [],\n    PL_IDS: []\n  }\n\n  checkUser();\n\n  chrome.extension.onMessage.addListener(function(msg, sender, sendResponse) {\n\n    if (msg.action == 'check_user') {\n      checkUser();\n    }\n  });\n\n  function getYtAr(channelId) {\n    chrome.runtime.sendMessage({ action: \"get_yt_ar\", channelId: channelId }, response => {\n      const elArr = getYtScripts(response);\n      const sText = elArr.filter(function (el) {\n        return el.textContent.indexOf(\"var ytcfg\") > -1;\n      });\n\n      if (sText[0].textContent.indexOf('SERVER_MILLIS_SINCE_EPOCH') > -1) {\n        client.ar = /SERVER_MILLIS_SINCE_EPOCH\":([^\"]+),/.exec(sText[0].textContent)[1];\n      }\n\n    });\n  }\n\n  function checkUser() {\n\n    loadOn();\n\n    $('body').append('<script id=\"initApp\"></script>')\n\n    chrome.runtime.sendMessage({ action: \"get_id\" }, response => {\n      getChannelId(response);\n    });\n\n    getTemplates();\n  }\n\n  function getChannelId(response) {\n    const elArr = getYtScripts(response);\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(response, \"text/html\");\n\n    let sText = elArr.filter(function(el) {\n      return el.textContent.indexOf(\"GUIDED_HELP\") > -1;\n    });\n\n    try {\n\t\t\tsText = sText[0].textContent.split('var ytInitialGuideData = JSON.parse(')[1].split(');')[0];\n\t\t\tsText = JSON.parse(sText);\n\t\t\tsText = JSON.parse(sText);\n\n\t\t\tconst serviceParams = sText.responseContext.serviceTrackingParams;\n\n\t\t\tserviceParams.forEach(function(item) {\n\t\t\t\tif (item.service === 'GUIDED_HELP') {\n\t\t\t\t\tchannelId = item.params[0].value;\n\t\t\t\t}\n\t\t\t});\n\n\t\t\tif (channelId) {\n\t\t\t\tcheckAuthState(elArr,channelId);\n\n\t\t\t\treturn;\n\t\t\t} else{\n\t\t\t\tthrow new Error('no channel ID');\n\t\t\t}\n\n\t\t} catch(e) {\n\t\t\tconsole.log(e)\n    }\n    \n    sText = elArr.filter(function(el){return el.textContent.indexOf(\"GUIDED_HELP\") > -1;});\n\n\n    if (sText[0].textContent.indexOf('creator_channel_id\",\"value\":\"') > -1) {\n      channelId = /creator_channel_id\",\"value\":\"([^\"]+)\"/.exec(\n        sText[0].textContent\n      )[1];\n    } else {\n      channelId = $(doc).find('.spf-link[title=\"Мой канал\"]').attr('href') || $(doc).find('.spf-link[title=\"My channel\"]').attr('href');\n\t\t\tchannelId = channelId.split('/channel/')[1];\n    }\n\n    checkAuthState(elArr, channelId);\n  }\n\n  function getChannelTitle(channelId) {\n    chrome.runtime.sendMessage(\n      { action: \"get_title\", id: channelId },\n      response => {\n        var parser = new DOMParser();\n        var doc = parser.parseFromString(response, \"text/html\");\n        var title = \"\";\n\n        if (doc.getElementsByTagName(\"title\")[1]) {\n          title = doc.getElementsByTagName(\"title\")[1].text;\n        } else {\n          title = doc.getElementsByTagName(\"title\")[0].text;\n        }\n\n        $(\".channel-title\").html(title);\n\n        // getVideos(1);\n\n        loadOff();\n      }\n    );\n  }\n\n  function checkAuthState(scripts, channelId) {\n    let tagText = scripts.filter(function(el) {\n      return el.textContent.indexOf(\"GAPI_HINT_PARAMS\") > -1;\n    });\n\n    if (typeof tagText[0] === \"undefined\") {\n      alert(\"Auth token error!\");\n      loadOff();\n      return false;\n    }\n\n    let auth_token = \"\";\n    if (tagText[0].textContent.indexOf('\"XSRF_TOKEN\"') > -1) {\n      auth_token = /XSRF_TOKEN\":\"([^\"]+)\"/.exec(tagText[0].textContent)[1];\n    } else {\n      tagText = scripts.filter(function(el) {\n        return el.textContent.indexOf(\"GOOGLE_HELP_CONTEXT\") > -1;\n      });\n      auth_token = /XSRF_TOKEN': \"([^\"]+)\"/.exec(tagText[0].textContent)[1];\n    }\n\n    setCookie(channelId, auth_token);\n\n    // getVideos();\n\n    getYtAr(channelId);\n\n    getChannelTitle(channelId);\n\n    localStorage.setItem(ch_id_name, channelId);\n  }\n\n  function getVideos(page, params = '') {\n    $('.success-text').addClass('hidden');\n    $('.error-block').addClass('hidden');\n\n    loadOn();\n\n    const promiseArr = [];\n    ytVideos = [];\n\n    chrome.runtime.sendMessage(\n      { action: \"get_new_videos\", page: page, params: params, ar: client.ar },\n      response => {\n        const elArr = getYtScripts(response);\n        const parser = new DOMParser();\n\n        const sText = elArr.filter(function(el) {\n          return el.textContent.indexOf(\"VIDEO_LIST_DISPLAY_OBJECT\") > -1;\n        });\n        \n        let elements = sText[0].textContent.split('VIDEO_LIST_DISPLAY_OBJECT\":')[1].split('}]')[0]+'}]';\n        elements = JSON.parse(elements);\n\n        elements.forEach((item) => {\n          const id = item.id;\n          item = parser.parseFromString(item.html, \"text/html\");\n          const title = $(item).find('.vm-video-title-content').text();\n          let time = $(item).find('.video-time').text().split(':');\n\n          if (!time) return;\n\n          if (time.length > 2) {\n            time = +(time[0]) * 60 * 60 + +(time[1]) * 60 + +(time[2]);\n          }else{\n            time = +(time[0]) * 60 + +(time[1]);\n          }\n\n          videos.push([id, time, title]);\n        });\n\n        elements.length < 25 ? page = 3 : page ++;\n        \n        if (page <= 2) {\n          getVideos(page, params);\n        }\n\n        if (page === 3) {\n          videos = videos.splice(0,50);\n\n          videos.forEach(item => {\n            let video = {\n              playlistVideoRenderer: {\n                videoId: item[0],\n                lengthSeconds: item[1],\n                title: item[2]\n              }\n            };\n    \n            ytVideos.push(video);\n    \n            checkVideoCard(item[0], video, promiseArr);         \n          });\n\n          Promise.all(promiseArr).then(()=>{\n            loadOff();\n\n            if (params) {\n              mostViewedVideos = ytVideos;\n\n              $('.js-most-videos-count').removeClass('hide');\n              $(\".js-most-count\").text(mostViewedVideos.length);\n            }else {\n              newVideos = ytVideos;\n              \n              $('.js-all-videos-count').removeClass('hide');\n              $(\".js-all-count\").text(newVideos.length);\n            }\n          });\n        }\n\n      });\n  }\n\n  function getTopPlVideos(plId) {\n    $('.success-text').addClass('hidden');\n\n    loadOn();\n\n    ytVideos = [];\n\n    chrome.runtime.sendMessage(\n      { action: \"get_pl_videos\", plId: plId },\n      response => {\n        try {\n          const elArr = getYtScripts(response);\n\n          const sText = elArr.filter(function(el) {\n            return el.textContent.indexOf(\"responseContext\") > -1;\n          });\n  \n          const ytData = sText[0].textContent\n            .split('window[\"ytInitialData\"] = ')[1]\n            .split(\"};\");\n          topPlVideos = JSON.parse(ytData[0] + '}').contents\n            .twoColumnBrowseResultsRenderer.tabs[0].tabRenderer.content\n            .sectionListRenderer.contents[0].itemSectionRenderer.contents[0]\n            .playlistVideoListRenderer.contents;\n  \n          const promiseArr = [];\n  \n          topPlVideos.forEach(item => {\n            const video = item.playlistVideoRenderer;\n            const findVideo = newVideos.find(function(element) {\n              return element.playlistVideoRenderer.videoId == video.videoId;\n            });\n\n            if (findVideo || !video.lengthSeconds) { return; }\n  \n            ytVideos.push(item);\n          });\n\n          ytVideos.forEach(item => {\n            const video = item.playlistVideoRenderer;\n\n            checkVideoCard(video.videoId, item, promiseArr);   \n          });\n\n          topPlVideos = ytVideos;\n\n          Promise.all(promiseArr).then((results)=>{\n            loadOff();\n  \n            // ytVideos = ytVideos.concat(topPlVideos);\n            \n            $('.js-pl-videos-count').removeClass('hide');\n            $('.js-playlist-count').text(topPlVideos.length);\n  \n            localStorageSetItem('PL_IDS', plId);\n\n            getTemplates();\n          });\n        }catch(e) {\n          loadOff();\n          \n          alert('Wrong Playlist or something else. Please contact Gila.');\n        }\n      }\n    );\n  }\n\n  function checkVideoCard(videoId, item, promiseArr) {\n    let videoPromise = new Promise((resolve, reject) =>{\n      chrome.runtime.sendMessage(\n        { action: \"check_card\", v: videoId },\n        response => {\n          item[\"cards\"] = [];\n\n          if (\n            response.feature_templates &&\n            response.feature_templates.length &&\n            response.feature_templates[0].key\n          ) {\n            item[\"cards\"] = response.feature_templates;\n          }\n\n          $(\".js-videos-count\").removeClass(\"hide\");\n\n          resolve(item);\n        }\n      );\n    });\n\n    promiseArr.push(videoPromise);\n  }\n\n  function setCard(videos, allVideos) {\n    return new Promise((resolve, reject) => {\n\n      videos.forEach((item, idx, array) => {\n        chrome.runtime.sendMessage(\n          { action: \"set_card\", v: item.video.playlistVideoRenderer.videoId, params: item.params },\n          (response) => {\n  \n            localStorageSetItem('IDS', item.params.video_item_id);\n            localStorageSetItem('MESSAGES', item.params.custom_message);\n            localStorageSetItem('TEASERS', item.params.teaser_text);\n\n            doneVideoCount++;\n            \n            $('.progress-bar span').text('Set cards');\n            $('.progress-bar-fill').css('width',100 * (doneVideoCount) / allVideos.length + '%');\n\n            const video = ytVideos.find(function(element) {\n              return element.playlistVideoRenderer.videoId == item.video.playlistVideoRenderer.videoId;\n            });\n  \n            if (response.error) {\n              fillErrors({error: 'Set card error:', video: video});\n\n              reject(response.videoId);\n              \n              return;\n            }\n\n            response = JSON.parse(response\n                .split('response\">')[1]\n                .split(\"</textarea>\")[0]);\n\n            if (response.errors) {\n              let error = '';\n\n              if (response.errors[0] === 'Invalid Request') {\n                error = response.form_errors[0].message;\n              }else{\n                for (let er in response.errors) {\n                  if (response.errors[er].trim().length) {\n                    error = response.errors[er];\n                  }\n                }\n              }\n\n              fillErrors({error: error + ':', video: video});\n            }else{\n              delete video['error'];\n              video[\"cards\"] = response.feature_templates;\n            }\n\n            if (idx === array.length -1) {\n              resolve();\n            }\n          }\n        );\n      });\n    });\n\n  }\n\n  function clearCard(videos, allVideos) {\n    return new Promise((resolve, reject) => {\n      videos.forEach((item, idx, array) => {\n        \n        let params = {\n          key: item.key,\n          session_token: getCookie(cookie_name + channelId)\n        };\n\n        chrome.runtime.sendMessage(\n          { action: \"clear_card\", v: item.id, params: params },\n          (response) => {\n            doneVideoCount++;\n\n            $('.progress-bar span').text('Deleting cards');\n            $('.progress-bar-fill').css('width',100 * (doneVideoCount) / allVideos.length + '%');\n\n            const video = ytVideos.find(function(element) {\n              return element.playlistVideoRenderer.videoId == item.id;\n            });\n\n            if (response.error) {\n              fillErrors({error: 'Can\\'t clear card:', video: video});\n\n              reject(response.videoId);\n              \n              return;\n            }\n\n            video[\"cards\"] = response.feature_templates;\n\n            if (idx === array.length - 1) {\n              resolve();\n            }\n          }\n        );\n      });\n    });\n  }\n\n  function fillErrors(options) {\n    const {video} = options;\n    $('.error-block').removeClass('hidden');\n\n    $('.errors-list').append(listItemTmp(\n        `${options.error} ${video.playlistVideoRenderer.title} (${video.playlistVideoRenderer.videoId})`, \n        'error'\n      )\n    );\n  }\n\n  function getYtScripts(response) {\n    const parser = new DOMParser();\n    const doc = parser.parseFromString(response, \"text/html\");\n    const elArr = Array.prototype.slice.call(doc.getElementsByTagName(\"script\"));\n\n    return elArr;\n  }\n\n  function copyCards(videoId) {\n    loadOn();\n\n    chrome.runtime.sendMessage(\n      { action: \"check_card\", v: videoId },\n      (response) => {\n        if (\n          response.feature_templates &&\n          response.feature_templates.length &&\n          response.feature_templates[0].key\n        ) {\n          cardsTemplates = response.feature_templates;\n\n          fillCards();\n\n          localStorageSetItem('COPY_IDS', videoId);\n\n          getTemplates();\n\n        }else{\n          alert('Bad Video Id: ' + videoId);\n        }\n\n        loadOff();\n      });\n  }\n\n  function fillCards() {\n    $('.card-block').each((idx,item) => {\n      if (!cardsTemplates[idx]) return;\n\n      let id = cardsTemplates[idx].video_id || cardsTemplates[idx].playlist_id || cardsTemplates[idx].channel_url;\n      let custom_message = cardsTemplates[idx].custom_message ;\n      let teaser_text = cardsTemplates[idx].teaser_text ;\n      \n      item = $(item);\n\n      item.find('.video_item_id').val(id);\n      item.find('.custom_message').val(custom_message);\n      item.find('.teaser_text').val(teaser_text);\n    });\n  }\n\n  function setCookie(channelId, auth_token) {\n    var now = new Date();\n    var time = now.getTime();\n    var expireTime = time + 1000 * 3300;\n    now.setTime(expireTime);\n    document.cookie =\n      cookie_name +\n      channelId +\n      \"=\" +\n      auth_token +\n      \"; path=/; expires=\" +\n      now.toGMTString();\n  }\n\n  function getTemplates() {\n    templates.IDS = localStorageGetItem('IDS') || [];\n    templates.MESSAGES = localStorageGetItem('MESSAGES') || [];\n    templates.TEASERS = localStorageGetItem('TEASERS') || [];\n    templates.COPY_IDS = localStorageGetItem('COPY_IDS') || [];\n    templates.PL_IDS = localStorageGetItem('PL_IDS') || [];\n\n    $('.list-content').html('');\n\n    const lists = ['IDS', 'MESSAGES', 'TEASERS', 'COPY_IDS', 'PL_IDS'];\n\n    lists.forEach((item) => {\n      templates[item].forEach((value) => {\n        $(`.${item.toLowerCase()}-list`).append(listItemTmp(value));\n      });\n    });\n  }\n\n  function refresh() {\n    videos = [];\n    topPlVideos = [];\n    newVideos = [];\n    mostViewedVideos = [];\n    ytVideos = [];\n\n    $('.b-input-x').val('');\n    $('.js-video-count').addClass('hide');\n    $('.error-block').addClass('hidden');\n    $('.success-text').addClass('hidden');\n    $('.errors-list').html('');\n  }\n\n  function getParams(links, item, i) {\n    const messages = [];\n    const teasers = [];\n    const start_ms = [];\n\n    $(\".custom_message\").each((idx, item) => {\n      messages.push(item.value ? item.value : '');\n    });\n    \n    $(\".teaser_text\").each((idx, item) => {\n      teasers.push(item.value ? item.value : '');\n    });\n\n    $(\".start_ms\").each((idx, item) => {\n      start_ms.push(item.value ? item.value : '');\n    });\n\n    let videoData = item.playlistVideoRenderer;\n\n    let params = {\n      key: \"\",\n      type: \"video\",\n      start_ms: 30000,\n      show_warnings: true,\n      video_item_id: \"\",\n      video_url: \"\",\n      custom_message: \"\",\n      teaser_text: \"\",\n      session_token: getCookie(cookie_name + channelId)\n    };\n\n    let lengthStep = 120 * 1000;\n\n    if (videoData.lengthSeconds < 600) {\n      lengthStep = Math.round((videoData.lengthSeconds / 6) * 1000);\n\n      params.start_ms = lengthStep;\n    }\n\n    if (links[i].indexOf('user') > -1 || links[i].indexOf('channel') > -1) {\n      delete params.action_create_video;\n      params['action_create_collaborator'] = 1;\n      params['channel_url'] = links[i];\n      params['type'] = 'collaborator';\n    }else {\n      delete params.channel_url;\n      delete params.action_create_collaborator;\n      params['action_create_video'] = 1;\n      params['type'] = 'video';\n    }\n    \n    params.video_item_id = links[i];\n    params.custom_message = messages[i];\n    params.teaser_text = teasers[i];\n\n    if (i > 0) {\n      params.start_ms += lengthStep * i;\n    }\n\n    if (start_ms[i]) {\n      let time = start_ms[i].split(':');\n\n      if (time.length > 2) {\n        time = +(time[0]) * 60 * 60 + +(time[1]) * 60 + +(time[2]);\n      }else{\n        time = +(time[0]) * 60 + +(time[1]);\n      }\n\n      params.start_ms = time * 1000;\n    }\n\n    return params;\n  }\n\n  // SET CARDS\n  $(\".js-set-card-btn\").on(\"click\", e => {\n    e.preventDefault();\n\n    const links = [];\n\n    $(\".video_item_id\").each((idx, item) => {\n      if (item.value) {\n        if (item.value.indexOf('/watch?v=') > -1) {\n          item.value = item.value.split('/watch?v=')[1]; \n        }\n\n        links.push(item.value);\n      }\n    });\n\n    if (!links.length || $('.b-input-error').length) return;\n\n    $('.progress-bar').addClass('_show');\n    $('.progress-bar-fill').css('width', 0 + '%');\n\n    $('.success-text').addClass('hidden');\n    $('.error-block').addClass('hidden');\n    $('.errors-list').html('');\n\n    ytVideos = topPlVideos.concat(newVideos).concat(mostViewedVideos);\n\n    \n\n    const clearArray = [];\n    const filledArray = [];\n    const filledArrayToClear = [];\n\n    for (let i = 0; i < links.length; i++) {\n      ytVideos.forEach((item,idx) => {\n        const params = getParams(links, item, i);\n\n        clearArray.push({video: item, params: params});\n      });\n    }\n\n    ytVideos.forEach((item,idx) => {\n      if (item.cards.length) {\n        filledArray.push(item)\n      }\n    });\n    \n    for (let k = 0; k < 5; k++) {\n      filledArray.forEach((item, idx, array) => {\n        if (!item.cards[k]) return;\n\n        filledArrayToClear.push({id: item.playlistVideoRenderer.videoId, key: item.cards[k].key});\n      });\n    }\n\n    const size = 1;\n    const deleteSize = 1;\n    const clearSubArray = [];\n    const filledSubArray = [];\n    \n    for (let i = 0; i <Math.ceil(clearArray.length/size); i++){\n      clearSubArray[i] = clearArray.slice((i*size), (i*size) + size);\n    }\n\n    for (let i = 0; i <Math.ceil(filledArrayToClear.length/deleteSize); i++){\n      filledSubArray[i] = filledArrayToClear.slice((i*deleteSize), (i*deleteSize) + deleteSize);\n    }\n\n    const setCardPromise = () => {\n      doneVideoCount = 0;\n\n      clearSubArray.reduce((previousPromise, subItem, idx, array) => {\n        return previousPromise.then(() => {\n          return setCard(subItem, clearArray).then(() => {\n            if (idx === array.length - 1) {\n              $('.progress-bar').removeClass('_show');\n              $('.success-text').removeClass('hidden');\n\n              getTemplates();\n            }\n          });\n        }).catch((e) => {\n\n          if (idx === array.length - 1) {\n            $('.progress-bar').removeClass('_show');\n            $('.success-text').removeClass('hidden');\n          }\n        });\n      }, Promise.resolve());\n    }\n\n    const clearCardPromise = () => {\n      doneVideoCount = 0;\n\n      filledSubArray.reduce((previousPromise, subItem, idx, array) => {\n        return previousPromise.then(() => {\n          return clearCard(subItem, filledArrayToClear).then(() => {\n            if (idx === array.length - 1) {\n              setCardPromise();\n            }\n          });\n        }).catch((e) => {\n\n          if (idx === array.length - 1) {\n            setCardPromise();\n          }\n        });\n      }, Promise.resolve());\n    }\n\n    if (filledSubArray.length) {\n      clearCardPromise();\n\n      return;\n    }\n\n    setCardPromise();\n  });\n\n  $('.list-ico').on('click', (e) => {\n    const type = e.currentTarget.dataset.type;\n    const btn = $(e.currentTarget);\n\n    \n    btn.toggleClass('open');\n    \n    if (templates[type].length) {\n      if (btn.hasClass('open')) {\n        $('.list-block').closest('div').removeClass('focus');\n        btn.closest('div').addClass('focus');\n      }else {\n        $('.list-ico').removeClass('open');\n        btn.closest('div').removeClass('focus');\n      }\n      // $(e.currentTarget).closest('div').toggleClass('focus');\n    }\n  });\n\n  $('.js-get-last').on('click', () => {\n    videos = [];\n\n    getVideos(1);\n  });\n\n  $('.js-get-list').on('click', () => {\n    var plId = $('.js-pl-id').val();\n    if (!plId) return;\n\n    getTopPlVideos(plId);\n  });\n\n  $('.js-get-most-viewed').on('click', () => {\n    videos = [];\n\n    getVideos(1, '&vmo=viewed&sa=0&sf=viewcount');\n  });\n\n  $('.js-copy-cards').on('click', () => {\n    var videoId = $('.js-video-id').val();\n\n    if (!videoId) return;\n\n    copyCards(videoId);\n  });\n\n  $('.js-refresh-btn').on('click', () => {\n    refresh();\n  });\n}\n","import content from './cards';\nimport endings from './endings';\n\nconst page = /cards/;\nconst match = page.exec(document.URL);\n\nif(match){\n  content();\n}\n\nendings();","export default function() {\n  var callToAction = /call_to_action/,\n    endings = /annotations/,\n    matchCall = callToAction.exec(document.URL),\n    matchEndings = endings.exec(document.URL),\n    match = matchCall || matchEndings;\n\n\n  var itemsObj = {},\n    itemImg;\n  var startState = true;\n  var ytId;\n\n  if(matchCall){\n\n    $(function(){\n      $('body').on('click','.js-get-tmp-btn',function(){\n        var token = $('.js-auth-token').val();\n        var videoTmpId = $('.js-ending-tmp').val();\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!videoTmpId){\n          return false;\n        }\n\n        $('.js-template').val('');\n        localStorage.removeItem('template');\n\n        loadOn();\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n\n        chrome.runtime.sendMessage({action: \"get_tmp_calls\", token: token, id: videoTmpId}, function(response){\n\n          if(response.description === 'error'){\n            if(response.error.status === 0){\n              showPopup('You are not authorized');\n            }else if(response.error.status === 400){\n              showPopup('Something wrong!');\n            }\n\n            loadOff();\n          }else{\n            var parser = new DOMParser();\n            var doc = parser.parseFromString(response, \"text/html\");\n    \n            if(!$(response.documentElement).find('annotation[type=\"promotion\"] data').length){ \n              loadOff();\n              showPopup('No image on this video!');\n              return false; \n            }\n\n            var overlay = JSON.parse($(response.documentElement).find('annotation[type=\"promotion\"] data')[0].innerHTML).image_url.split('/');\n            itemImg = overlay[overlay.length - 1].split('.')[0];\n    \n            ytId = JSON.parse($(response.documentElement).find('annotation[type=\"branding\"] data')[0].innerHTML).channel_id;\n\n            if(ytId != localStorage.getItem('call_ch_id')){\n              showPopup('Use the correct account!');\n              $('.js-check-all').prop('checked',false);\n              loadOff();\n              return false;\n            }\n            loadOff();\n          }\n          \n        });\n\n      })\n\n      $('body').on('click','.js-revert-all-btn',function(){\n        var videoObj = {};\n\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!itemsArr.length){\n          return false;\n        }\n        loadOn();\n        var token = getCookie('call_auth_token_'+ytId);\n        if (!token){\n          checkUser();\n        }\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n        $.each(itemsArr,function(idx,item){\n          var data = JSON.parse(localStorage.getItem('template'));\n          data.push({'name': 'video_id', 'value': item.id});\n          data.push({'name': 'session_token', 'value': token});\n\n          for(var j in data){\n            if(data[j].name == 'cta_display_url' || data[j].name == 'cta_destination_url' || data[j].name == 'cta_text1'){\n              data[j].value = '';\n            }\n          }\n\n          chrome.runtime.sendMessage({action: \"revert_calls\", data: data}, function(response){\n            \n            if(response.error){\n              $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n              $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n              $('.js-check-all').prop('checked',false);\n\n              loadOff();\n            }else{\n              $.get('/admin/call_to_action?action=annotate&video_id='+item.id+'&is_promo=false&channel_id='+ytId).then(function(resp){\n                $('.b-list-item[data-id=\"'+item.id+'\"]').slideUp(200, function(){\n                  $(this).remove();\n                });\n\n                loadOff();\n              });\n            }\n          });\n          \n        })\n      });\n\n      $('body').on('click','.js-pub-all-btn',function(){\n        var videoObj = {};\n\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!itemsArr.length || !$('.js-template').val()){\n          return false;\n        }\n        loadOn();\n        var token = getCookie('call_auth_token_'+ytId);\n        if (!token){\n          checkUser();\n        }\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n        $.each(itemsArr,function(idx,item){\n          var data = JSON.parse(localStorage.getItem('template'));\n          data.push({'name': 'video_id', 'value': item.id});\n          data.push({'name': 'session_token', 'value': token});\n\n          for(var j in data){\n            if(data[j].name == 'cta_image_id'){\n              data[j].value = itemImg;\n            }\n          }\n\n          chrome.runtime.sendMessage({action: \"pub_calls\", data: data}, function(response){\n\n            var is_promo;\n            if ($('.js-tab-item[data-tab=\"short,2\"]').hasClass('current')){\n              is_promo = true;\n            }else{\n              is_promo = false;\n            }\n\n            if((response.metadata_errors && response.metadata_errors.length) || response.error){\n              $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n              $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n              $('.js-check-all').prop('checked',false);\n\n              try{\n                showPopup(resp.metadata_errors[0].message);\n              }catch(e){console.log(e)}\n\n              loadOff();\n\n            }else{\n              $.get('/admin/call_to_action?action=annotate&video_id='+item.id+'&is_promo='+is_promo+'&channel_id='+ytId).then(function(){\n                loadOff();\n\n                if(is_promo){\n                  $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n                  $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('suc');\n                  setTimeout(function(){\n                    $('.b-list-item[data-id=\"'+item.id+'\"]').removeClass('suc');\n                  },700);\n                }else{\n                  $('.b-list-item[data-id=\"'+item.id+'\"]').slideUp(200, function(){\n                    $(this).remove();\n                  });\n                }\n              });\n            }\n          });\n        \n        })\n      });\n\n    })\n\n  }else if(matchEndings){\n    $(function(){\n      $('body').on('click','.js-get-tmp-btn',function(){\n        var token = $('.js-auth-token').val();\n        var videoTmpId = $('.js-ending-tmp').val();\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!videoTmpId || !itemsArr.length){\n          return false;\n        }\n        loadOn();\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n        $.each(itemsArr,function(idx,item){\n          itemsObj[group+'_end_'+item.id] = {};\n\n          chrome.runtime.sendMessage({action: \"get_tmp_endings\", id: item.id, tmpId: videoTmpId, token: token}, function(response){\n            loadOff();\n\n            if(response.for_editor){\n              itemsObj[group+'_end_'+item.id] = response.for_editor;\n    \n              $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('suc').removeClass('err');\n            }else{\n              if(response.description === 'error' && response.error.status === 0){\n                showPopup('You are not authorized');\n              }else if(response.error.status === 400){\n                showPopup('Something wrong!');\n              }\n\n              loadOff();\n              $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n              $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n              $('.js-check-all').prop('checked',false);\n            }\n          });\n        })\n\n      })\n      $('body').on('click','.js-revert-all-btn',function(){\n        var videoObj = {};\n\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!itemsArr.length){\n          return false;\n        }\n        loadOn();\n        var token = getCookie('annotation_auth_token_'+ytId);\n        if (!token){\n          checkUser();\n        }\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n        $.each(itemsArr,function(idx,item){\n          if(!itemsObj[group+'_end_'+item.id]) {\n            loadOff();\n            $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n          }else{\n            videoObj[item.id] = itemsObj[group+'_end_'+item.id];\n            videoObj[item.id]['encrypted_video_id'] = item.id;\n            videoObj[item.id]['action_save'] = 1;\n            videoObj[item.id]['v'] = item.id;\n\n            videoObj[item.id]['session_token'] = token\n\n            chrome.runtime.sendMessage({action: \"revert_endings\", id: item.id, videoObj: videoObj[item.id]}, function(response){\n              \n              if(response.body === 'ok'){\n                $.get('/admin/annotations?action=annotate&video_id='+item.id+'&is_promo=false&channel_id='+ytId).then(function(){\n                  $('.b-list-item[data-id=\"'+item.id+'\"]').slideUp(200, function(){\n                    $(this).remove();\n                  });\n\n                  loadOff();\n                });\n              }else{\n                $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n                $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n                $('.js-check-all').prop('checked',false);\n\n                loadOff();\n              }\n            });\n          }\n        })\n      });\n\n      $('body').on('click','.js-pub-all-btn',function(){\n        var videoObj = {};\n\n        var itemsArr = [];\n        $('.js-check-video').each(function(i,item){\n          var item = $(item);\n          if(item.prop('checked')===true){\n            itemsArr.push({id: item.val()});\n          }\n        });\n\n        if(!itemsArr.length){\n          return false;\n        }\n        loadOn();\n        var token = getCookie('annotation_auth_token_'+ytId);\n        if (!token){\n          checkUser();\n        }\n        var group = $('.js-tab-item.current').data('tab').split(',')[1];\n        $.each(itemsArr,function(idx,item){\n          if(!itemsObj[group+'_end_'+item.id]) {\n            loadOff();\n            $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n          }else{\n            videoObj[item.id] = itemsObj[group+'_end_'+item.id];\n            videoObj[item.id]['encrypted_video_id'] = item.id;\n            videoObj[item.id]['action_save'] = 1;\n            videoObj[item.id]['v'] = item.id;\n\n            videoObj[item.id]['session_token'] = token\n\n            chrome.runtime.sendMessage({action: \"pub_endings\", id: item.id, videoObj: videoObj[item.id]}, function(response){\n              var is_promo;\n              if ($('.js-tab-item[data-tab=\"short,2\"]').hasClass('current')){\n                is_promo = true;\n              }else{\n                is_promo = false;\n              }\n\n              if(response.error || response.errors){\n                $('.b-list-item[data-id=\"'+item.id+'\"]').addClass('err');\n                $('.b-list-item[data-id=\"'+item.id+'\"] input').prop('checked',false);\n                $('.js-check-all').prop('checked',false);\n\n                loadOff();\n              }else{\n                $.get('/admin/annotations?action=annotate&video_id='+item.id+'&is_promo='+is_promo+'&channel_id='+ytId).then(function(){\n                  $('.b-list-item[data-id=\"'+item.id+'\"]').slideUp(200, function(){\n                    $(this).remove();\n                  });\n                  loadOff();\n                });\n              }\n            });\n            \n          }\n\n        })\n      });\n\n    })\n  }\n\n  var cookie_name,\n    ch_id_name,\n    tollName;\n\n  if(match){\n    if(match[0] == 'call_to_action'){\n      cookie_name = 'call_auth_token_';\n      ch_id_name = 'call_ch_id';\n      tollName = 'Call To Action';\n    }else{\n      cookie_name = 'annotation_auth_token_';\n      ch_id_name = 'ann_ch_id';\n      tollName = 'Endings';\n    }\n    var list = document.getElementsByClassName(\"b-content\");\n    var newLi = document.createElement('div');\n    newLi.setAttribute(\"class\", \"js-get-token\");\n    newLi.onclick = function(e){\n      e.preventDefault();\n      \n      checkUser();\n      \n    };\n    newLi.innerHTML = 'Get token';\n    list[0].appendChild(newLi);\n\n    function checkUser(){\n      loadOn();\n\n\n      chrome.runtime.sendMessage({action: \"get_id\"}, function(response){\n        getChannelId(response);\n      });\n    }\n\n    function getChannelId(response) {\n      var parser = new DOMParser();\n      var doc = parser.parseFromString(response, \"text/html\");\n      var elArr = Array.prototype.slice.call(doc.getElementsByTagName(\"script\"));\n      var sText = elArr.filter(function(el){return el.textContent.indexOf(\"GUIDED_HELP\") > -1;});\n\n      try {\n        sText = sText[0].textContent.split('var ytInitialGuideData = JSON.parse(')[1].split(');')[0];\n        sText = JSON.parse(sText);\n        sText = JSON.parse(sText);\n\n        var serviceParams = sText.responseContext.serviceTrackingParams;\n\n        serviceParams.forEach(function(item) {\n          if (item.service === 'GUIDED_HELP') {\n            ytId = item.params[0].value;\n          }\n        });\n\n        if (ytId) {\n          getChannelTitle(ytId);\n\n          checkAuthState(elArr,ytId);\n\n          return;\n        } else{\n          throw new Error('no channel ID');\n        }\n\n      } catch(e) {\n        console.log(e);\n      }\n\n      sText = elArr.filter(function(el){return el.textContent.indexOf(\"GUIDED_HELP\") > -1;});\n\n      if(sText[0].textContent.indexOf('creator_channel_id\",\"value\":\"') > -1){\n        ytId = /creator_channel_id\",\"value\":\"([^\"]+)\"/.exec(sText[0].textContent)[1];\n      }else{\n        ytId = $(doc).find('.spf-link[title=\"Мой канал\"]').attr('href') || $(doc).find('.spf-link[title=\"My channel\"]').attr('href');\n        ytId = ytId.split('/channel/')[1]\n        // sText = elArr.filter(function(el){return el.textContent.indexOf(\"GAPI_HINT_PARAMS\") > -1;});\n        // ytId = /creator_channel_id\":\"([^\"]+)\"/.exec(sText[0].textContent)[1];\n      }\n      \n\n      getChannelTitle(ytId);\n\n      checkAuthState(elArr,ytId);\n    }\n\n    function getChannelTitle(id) {\n      chrome.runtime.sendMessage({action: \"get_title\", id: id}, function(response){\n        var parser = new DOMParser();\n        var doc = parser.parseFromString(response, \"text/html\");\n\n        var title = '';\n\n        if(doc.getElementsByTagName(\"title\")[1]){\n          title = doc.getElementsByTagName(\"title\")[1].text;\n        }else{\n          title = doc.getElementsByTagName(\"title\")[0].text;\n        }\n\n        $('.js-channel-title').html(tollName+'&nbsp;-&nbsp;'+title);\n      });\n    }\n\n    function checkAuthState(scripts,ytId) {\n      var listWrap = document.getElementsByClassName('b-list-wrap')[0];\n      var tokenInp = document.getElementsByClassName('js-auth-token')[0];\n\n      var tagText = scripts.filter(function(el){return el.textContent.indexOf(\"GAPI_HINT_PARAMS\") > -1;});\n\n      if(typeof tagText[0] === 'undefined'){\n        alert('Auth token error!')\n        listWrap.setAttribute('id','disable');\n        listWrap.innerHTML = '';\n        loadOff();\n        return false;\n      }\n\n      var auth_token = '';\n      if(tagText[0].textContent.indexOf('\"XSRF_TOKEN\"') > -1){\n        auth_token = /XSRF_TOKEN\":\"([^\"]+)\"/.exec(tagText[0].textContent)[1]\n      }else{\n        tagText = scripts.filter(function(el){return el.textContent.indexOf(\"GOOGLE_HELP_CONTEXT\") > -1;});\n        auth_token = /XSRF_TOKEN': \"([^\"]+)\"/.exec(tagText[0].textContent)[1]\n      }\n\n      tokenInp.value = auth_token;\n      setCookie(ytId,auth_token);\n      loadOff();\n\n      checkChannelId(ytId);\n    }\n\n    function checkChannelId(ytId) {\n      var listWrap = document.getElementsByClassName('b-list-wrap')[0];\n      \n      if(localStorage.getItem(ch_id_name) != ytId){\n        localStorage.setItem(ch_id_name,ytId);\n        $('.js-tab-item.current').trigger('click');\n      }else{\n        localStorage.setItem(ch_id_name,ytId);\n      }\n\n      if(startState){\n        $('.js-tab-item.current').trigger('click');\n        startState = false;\n      }\n\n      listWrap.setAttribute('id','');\n    }\n\n    function setCookie(channelId,auth_token) { \n      var now = new Date();\n      var time = now.getTime();\n      var expireTime = time + 1000*3300;\n      now.setTime(expireTime);\n      document.cookie = cookie_name+channelId+\"=\"+auth_token+\"; path=/; expires=\" + now.toGMTString();\n    }\n  }\n\n  function showPopup(text){\n    $('.b-popup').addClass('_show');\n    $('.b-popup-box').html(text);\t\n    setTimeout(function(){\n      hidePopup();\n    },1500);\n  }\n\n  function hidePopup(){\n    $('.b-popup').removeClass('_show');\t\n  }\n\n  function loadOn(){\n    $('.b-loader').show();\t\n  }\n\n  function loadOff(){\n    $('.b-loader').hide();\t\n  }\n\n  function getCookie(name) {\n    var matches = document.cookie.match(new RegExp(\n      \"(?:^|; )\" + name.replace(/([\\.$?*|{}\\(\\)\\[\\]\\\\\\/\\+^])/g, '\\\\$1') + \"=([^;]*)\"\n    ));\n    return matches ? decodeURIComponent(matches[1]) : undefined;\n  }\n\n  var videoSettings = [\n    {\"name\":\"title\",\"value\":\"\"},\n    {\"name\":\"description\",\"value\":\"\"},\n    {\"name\":\"keywords\", \"value\": \"\"},\n    {\"name\":\"privacy\",\"value\":\"public\"},\n    {\"name\":\"notify_via_email\",\"value\":\"true\"},\n    {\"name\":\"share_emails\",\"value\":\"\"},\n    {\"name\":\"deleted_ogids\",\"value\":\"\"},\n    {\"name\":\"deleted_circle_ids\",\"value\":\"\"},\n    {\"name\":\"deleted_emails\",\"value\":\"\"},\n    {\"name\":\"playlists_values\",\"value\":\"InvalidValue\"},\n    {\"name\":\"privacy_draft\",\"value\":\"\"},\n    {\"name\":\"still_id\",\"value\":\"0\"},\n    {\"name\":\"thumbnail_preview_version\",\"value\":\"\"},\n    {\"name\":\"claim_style\",\"value\":\"ads\"},\n    {\"name\":\"claim_usage_policy\",\"value\":\"S526445693826128\"},\n    {\"name\":\"claim_match_policy\",\"value\":\"\"},\n    {\"name\":\"allow_comments\",\"value\":\"yes\"},\n    {\"name\":\"allow_comments_detail\",\"value\":\"all\"},\n    {\"name\":\"allow_comments_sort_order\",\"value\":\"top_comments\"},\n    {\"name\":\"allow_ratings\",\"value\":\"yes\"},\n    {\"name\":\"reuse\",\"value\":\"all_rights_reserved\"},\n    {\"name\":\"captions_certificate_reason\",\"value\":\"\"},\n    {\"name\":\"allow_embedding\",\"value\":\"yes\"},\n    {\"name\":\"location_longitude\",\"value\":\"\"},\n    {\"name\":\"location_latitude\",\"value\":\"\"},\n    {\"name\":\"location_altitude\",\"value\":\"\"},\n    {\"name\":\"audio_language\",\"value\":\"ru\"},\n    {\"name\":\"recorded_date\",\"value\":\"\"},\n    {\"name\":\"cta_text1\",\"value\":\"Богатейшие кланы России\"},\n    {\"name\":\"cta_text2\",\"value\":\"text2\"},\n    {\"name\":\"cta_text3\",\"value\":\"text3\"},\n    {\"name\":\"cta_image_id\",\"value\":\"1504107731885497\"},\n    {\"name\":\"cta_display_url\",\"value\":\"www.vesti.ru\"},\n    {\"name\":\"cta_destination_url_scheme\",\"value\":\"http://\"},\n    {\"name\":\"cta_destination_url\",\"value\":\"www.vesti.ru/doc.html?id=2926720&utm_source=youtube&utm_medium=banner&utm_campaign=youtube-banner\"},\n    {\"name\":\"cta_enabled_on_mobile\",\"value\":\"yes\"},\n    {'name': 'modified_fields', 'value': 'cta_enabled_on_mobile,cta_display_url,cta_destination_url_scheme,cta_destination_url,cta_image_id'},\n    {'name': 'allow_public_stats', 'value': 'no'},\n    {'name': 'captions_crowdsource', 'value': 'no'},\n    {'name': 'self_racy', 'value': 'no'},\n    {'name': 'creator_share_feeds', 'value': 'yes'},\n    {'name': 'claim_match_enabled', 'value': 'no'}\n  ]\n\n  localStorage.setItem('videoSettings',JSON.stringify(videoSettings));\n}"],"sourceRoot":""}